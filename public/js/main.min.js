(function(){var t,e,o;t=function(){function t(t){this.el=t,this.rangeTable=new e(this.el.find(".range-control__range")),this.initControls()}return t.prototype.initControls=function(){var t=this;return this.leftControl=this.el.find(".range-control__left"),this.rightControl=this.el.find(".range-control__right"),this.leftControl.on("dragstart",function(){return!1}),this.rightControl.on("dragstart",function(){return!1}),this.leftControl.on("mousedown",function(e){var o,n,l,i;return t.leftControl.addClass("is-dragged"),i=t.el.offset().left,l=e.clientX-t.leftControl.offset().left,o=0,n=t.rightControl.offset().left-i,$(document).on("mousemove",function(e){return t.controlMoveTo(t.leftControl,e.clientX,i,l,o,n)})}),this.rightControl.on("mousedown",function(e){var o,n,l,i,r;return t.rightControl.addClass("is-dragged"),r=t.el.offset().left,o=t.rightControl.outerWidth(),i=e.clientX-t.rightControl.offset().left,n=t.leftControl.offset().left-r+t.leftControl.outerWidth(),l=t.el.width(),$(document).on("mousemove",function(e){return $(document).on("mousemove",function(){}),t.controlMoveTo(t.rightControl,e.clientX,r,i,n,l)})}),this.leftControl.on("mouseup",function(){return t.leftControl.removeClass("is-dragged"),$(document).off("mousemove")}),this.rightControl.on("mouseup",function(){return t.rightControl.removeClass("is-dragged"),$(document).off("mousemove")}),$(document).on("mouseup",function(){return t.leftControl.triggerHandler("mouseup"),t.rightControl.triggerHandler("mouseup")})},t.prototype.controlMoveTo=function(t,e,o,n,l,i){var r,s,a,h,u;return r=t.outerWidth(),s=e-o-n,h=e-o-n+r,s>=l&&i>h&&t.css("left",s),l>s&&t.css("left",l),h>i&&t.css("left",i-r),t===this.leftControl&&this.changeControlRateText(t,this.rangeTable.getRateByPosition(t.position().left)),t===this.rightControl&&this.changeControlRateText(t,this.rangeTable.getRateByPosition(t.position().left-r)),this.rangeTable.cells.addClass("is-disabled"),a=this.rangeTable.getCellByPosition(this.leftControl.position().left).index()-3,u=this.rangeTable.getCellByPosition(this.rightControl.position().left-r).index()+3,a>=0?this.rangeTable.cells.slice(a,u).removeClass("is-disabled"):this.rangeTable.cells.slice(0,u).removeClass("is-disabled"),console.log({left:this.rangeTable.getRateByPosition(this.leftControl.position().left),right:this.rangeTable.getRateByPosition(this.rightControl.position().left-r)})},t.prototype.changeControlRateText=function(t,e){return t.find("span").text(o.shortenVolumeToName(e))},t}(),e=function(){function t(t){this.el=t,this.cells=this.el.find("div"),this.cellHoverEl=$("<div/>").addClass("range-control__cell-hover").insertBefore(this.el),this.cellWidth=100/this.cells.size(),this.data=[],this.height=this.el.height(),this.buildDataFromCells(),this.buildCells()}return t.prototype.buildDataFromCells=function(){var t;return this.data=this.cells.map(function(t,e){return{volume:$(e).data("volume"),rate:$(e).data("rate")}}),this.maxVolume=Math.max.apply(null,function(){var e,o,n,l;for(n=this.data,l=[],e=0,o=n.length;o>e;e++)t=n[e],l.push(t.volume);return l}.call(this))},t.prototype.buildCells=function(){var t=this;return this.cells.each(function(e,o){return o=$(o),$("<i/>").appendTo(o).height(100/t.maxVolume*o.data("volume")+"%"),o.width(t.cellWidth+"%"),t.colorizeCell(o),t.bindHoverToCell(o)})},t.prototype.colorizeCell=function(t){var e,o,n,l,i,r;o={"light-green":[0,100],"middle-green":[101,1e3],green:[1001,1e4],yellow:[10001]},r=[];for(e in o){if(n=o[e][0],l=o[e][1],(i=t.data("rate"))>=n&&l>=i||t.data("rate")>=n&&!l){t.addClass(e);break}r.push(void 0)}return r},t.prototype.getRateByPosition=function(t){return $(this.getCellByPosition(t)).data("rate")},t.prototype.getCellByPosition=function(t){var e,o;return o=this.el.width()/100*this.cellWidth,e=Math.ceil(t/o),e>=this.cells.size()?this.cells.last():this.cells.eq(e)},t.prototype.bindHoverToCell=function(t){var e,n;return t=$(t),n=t.position().left,e=this.cellHoverEl,t.hover(function(){return e.show().css("left",n).text(o.splitVolumeBySpace(t.data("rate")))},function(){return e.hide()})},t}(),o={shortenVolumeToName:function(t){return 1e3>t?t:1e6>t?(""+t/1e3).replace(".",",")+" тыс.":t>=1e6?(""+t/1e6).replace(".",",")+" млн.":void 0},splitVolumeBySpace:function(t){return(""+t).replace(/\B(?=(\d{3})+(?!\d))/g," ")}},$(".range-control").each(function(e,o){return new t($(o))})}).call(this);