!function(){var a,b,c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};a=function(){function a(a,b){this.el=a,this.options=b,this.settings=$.extend({},this.defaultOptions,b),this.el.data(this.PLUGINNAME,this),this._formatControlCallback=this.settings.formatControlCallback,this._renderRangeControl(),this.min(this.el.data("min")||this.settings.min),this.max(this.el.data("max")||this.settings.max),this.step(this.el.data("step")||this.settings.step),this._initDimensions(),this.leftValue(this.el.data("left-value")||this.settings.leftValue||this._min),this.rightValue(this.el.data("right-value")||this.settings.rightValue||this._max),this._initControls(),this._bindResize()}return a._min,a._max,a._leftControlValue,a._rightControlValue,a._step,a._dragged,a._renderControlCallback,a._width,a._widthWithoutPaddings,a._controlWidth,a._pxInValue,a._rangeElement,a._changeTimeout,a.prototype.PLUGINNAME="range-control",a.prototype.DRAGCLASSNAME="is-dragged",a.prototype.keyCode={LEFT:37,RIGHT:39},a.prototype.defaultOptions={keyLeft:a.prototype.keyCode.LEFT,keyRight:a.prototype.keyCode.RIGHT,min:0,max:100,step:1,timeout:500,formatControlCallback:function(a){return a}},a.prototype.min=function(a){return null!=a?this._min=parseInt(a):this._min},a.prototype.max=function(a){return null!=a?this._max=parseInt(a):this._max},a.prototype.step=function(a){return a?this._step=parseInt(a):this._step},a.prototype.value=function(){return{leftValue:this._getLeftValue(),rightValue:this._getRightValue()}},a.prototype.leftValue=function(a){return null!=a?(this._leftControlValue=this._validateLeftValue(a),this._renderLeftControl(this._leftControlValue),this._formatLeftControl(),this._renderRange()):this._getLeftValue()},a.prototype.rightValue=function(a){return null!=a?(this._rightControlValue=this._validateRightValue(a),this._renderRightControl(this._rightControlValue),this._formatRightControl(),this._renderRange()):this._getRightValue()},a.prototype._getLeftValue=function(){return 1===this._valueStep?this._leftControlValue:this._min+(this._leftControlValue-this._min-(this._leftControlValue-this._min)%this._step)},a.prototype._getRightValue=function(){return 1===this._valueStep?this._rightControlValue:this._min+(this._rightControlValue-this._min-(this._rightControlValue-this._min)%this._step)},a.prototype._getValueByPosition=function(a){return this._min+Math.round(a/this._pxInValue)},a.prototype._valueByControl=function(a,b){if(null!=a){if(a[0]===this._leftControl[0])return null!=b?this.leftValue(b):this._leftControlValue;if(a[0]===this._rightControl[0])return null!=b?this.rightValue(b):this._rightControlValue}},a.prototype._getPositionByValue=function(){},a.prototype._bindControlKeys=function(){var a,b,c,d,e,f=this;for(b=[this._leftControl,this._rightControl],e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a.on("keydown",function(b){return a=$(b.currentTarget),b.keyCode===f.settings.keyLeft?f._valueByControl(a,f._valueByControl(a)-1):b.keyCode===f.settings.keyRight?f._valueByControl(a,f._valueByControl(a)+1):void 0}));return e},a.prototype._bindResize=function(){var a=this;return $(window).on("resize",function(){return a.render()})},a.prototype._initDimensions=function(){return this._controlWidth=this._leftControl.outerWidth(),this._width=this.el.outerWidth(),this._widthWithoutPaddings=this.el.width(),this._pxInValue=this._widthWithoutPaddings/(this._max-this._min)},a.prototype._initControls=function(){var a,b,c,d,e=this;for(b=[this._leftControl,this._rightControl],c=0,d=b.length;d>c;c++)a=b[c],a.on("dragstart",function(){return!1}),a.on("mouseup",function(){return e.dragged=!1,a.removeClass(e.DRAGCLASSNAME),$(document).off("mousemove")});return this._leftControl.on("mousedown",function(a){var b,c,d,f;if(1===a.which)return e._leftControl.addClass(e.DRAGCLASSNAME),e._dragged=!0,f=e.el.offset().left,d=a.clientX-e._leftControl.offset().left,b=0,c=e._rightControl.offset().left-f,$(document).on("mousemove",function(a){return e._controlMoveTo(e._leftControl,a.clientX,f,d,b,c)})}),this._rightControl.on("mousedown",function(a){var b,c,d,f;if(1===a.which)return e._rightControl.addClass(e.DRAGCLASSNAME),e._dragged=!0,f=e.el.offset().left,d=a.clientX-e._rightControl.offset().left,b=e._leftControl.offset().left-f+e._controlWidth,c=e._width,$(document).on("mousemove",function(a){return e._controlMoveTo(e._rightControl,a.clientX,f,d,b,c)})}),$(document).on("mouseup",function(){return e._leftControl.triggerHandler("mouseup"),e._rightControl.triggerHandler("mouseup")}),this._renderLeftControl(this._leftControlValue),this._renderRightControl(this._rightControlValue),this._bindControlKeys()},a.prototype._controlMoveTo=function(a,b,c,d,e,f){var g,h,i;return h=b-c-d,i=b-c-d+this._controlWidth,h>=e&&f>i&&(g=h),e>h&&(g=e),i>f&&(g=f-this._controlWidth),a===this._leftControl&&this.leftValue(this._getValueByPosition(g)),a===this._rightControl&&this.rightValue(this._getValueByPosition(g-this._controlWidth)),this._fireChangeEvent()},a.prototype._renderRangeControl=function(){var a;return this.el.addClass(this.PLUGINNAME),this.el.children().remove(),this._leftControl=$("<button class='"+this.PLUGINNAME+"__left'></button>"),this._rightControl=$("<button class='"+this.PLUGINNAME+"__right'></button>"),this._rangeElement=$("<div class='"+this.PLUGINNAME+"__range is-active'></div>"),a=$("<div class='"+this.PLUGINNAME+"__range'></div>"),this.el.append(this._leftControl).append(this._rightControl).append(a).append(this._rangeElement)},a.prototype._renderRange=function(){var a,b;return a=(this._leftControlValue-this._min)*this._pxInValue+this._controlWidth-this._controlWidth/2,b=(this._rightControlValue-this._min)*this._pxInValue+this._controlWidth+this._controlWidth/2,this._rangeElement.css({left:a,right:this._width-b})},a.prototype._renderLeftControl=function(a){var b;return b=(a-this._min)*this._pxInValue,this._leftControl.css({left:b})},a.prototype._renderRightControl=function(a){var b;return b=this._controlWidth+(a-this._min)*this._pxInValue,this._rightControl.css({left:b})},a.prototype._validateLeftValue=function(a){return a<=this._min?this._min:a>=this._rightControlValue?this._rightControlValue:a},a.prototype._validateRightValue=function(a){return a>=this._max?this._max:a<=this._leftControlValue?this._leftControlValue:a},a.prototype._formatLeftControl=function(){return null!=this._formatControlCallback?this._leftControl.html(this._formatControlCallback(this.leftValue())):void 0},a.prototype._formatRightControl=function(){return null!=this._formatControlCallback?this._rightControl.html(this._formatControlCallback(this.rightValue())):void 0},a.prototype._formatValue=function(a){return a},a.prototype._fireChangeEvent=function(){var a=this;return clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){return a.el.trigger("change",a.value())},this.settings.timeout)},a.prototype.render=function(){return this._initDimensions(),this.leftValue(this._leftControlValue),this.rightValue(this._rightControlValue)},a.prototype.rebuild=function(a){return null==a&&(a=this.options),this.constructor(this.el,a)},a.prototype.destroy=function(){return this.el.html(""),this.el.removeData(this.PLUGINNAME)},a}(),b=function(a){function b(a,c){this.el=a,this.options=c,this.settings=$.extend({},this.defaultOptions,c),this._renderRangeControl(),this._initDimensions(),this._renderRange(),this.min(0),this.max(Object.keys(this.options.data).length),this.leftValue(this.min()),this.rightValue(this.max()),b.__super__.constructor.call(this,this.el,$.extend(this.settings,{min:this.min(),max:this.max()}))}return d(b,a),b.prototype.PLUGINNAME="range-control-graph",b.prototype.defaultOptions={keyLeft:b.prototype.keyCode.LEFT,keyRight:b.prototype.keyCode.RIGHT,min:0,max:100,step:1,timeout:500,formatControlCallback:function(a){return a},colorsRange:{"#e6ead4":[0,100],"#ced7a6":[101,1e3],"#b4c373":[1001,1e4],"#fed46d":[10001]},colorCell:"#288bf0"},b.prototype._renderRangeControl=function(){return this.el.addClass(this.PLUGINNAME),this.el.children().remove(),this._leftControl=$("<button class='"+this.PLUGINNAME+"__left'></button>").appendTo(this.el),this._rightControl=$("<button class='"+this.PLUGINNAME+"__right'></button>").appendTo(this.el),this._rangeElement=$("<canvas class='"+this.PLUGINNAME+"__range'></canvas>").appendTo(this.el),this._rangeElementHover=$("<canvas class='"+this.PLUGINNAME+"__range-hover'></canvas>").appendTo(this.el),this._rangeGreyWrapLeft=$("<div class='"+this.PLUGINNAME+"__wrap-range-grey-left'></div>"),this._rangeGreyElementLeft=$("<canvas class='"+this.PLUGINNAME+"__range-grey'></canvas>").appendTo(this._rangeGreyWrapLeft),this._rangeGreyWrapRight=$("<div class='"+this.PLUGINNAME+"__wrap-range-grey-right'></div>"),this._rangeGreyElementRight=$("<canvas class='"+this.PLUGINNAME+"__range-grey'></canvas>").appendTo(this._rangeGreyWrapRight),this._rangeGreyWrapLeft.appendTo(this.el),this._rangeGreyWrapRight.appendTo(this.el)},b.prototype._renderRange=function(){var a,b,c,d;return b=function(){var a,b;a=this.options.data,b=[];for(c in a)d=a[c],b.push(d);return b}.call(this),this._maxRangeVolume=Math.max.apply(null,b),a=Object.keys(this.options.data).length,this.canvas=this._rangeElement[0].getContext("2d"),this.canvasScale=30,this.canvasHeight=this.el.height(),this.canvasWidth=a*this.canvasScale,this._rangeElement[0].width=a*this.canvasScale,this._rangeElement[0].height=this.el.height(),this._rangeElement.width(this._widthWithoutPaddings),this._renderColorRange(),this._renderRangeCells(),this._renderGreyRange(),this._renderRangeWraps(),this._renderRangeHover()},b.prototype._renderColorRange=function(){var a,b,c,d,e,f,g,h;if(null==this.dataColorRange){this.dataColorRange={},b=this.settings.colorsRange,c=this.settings.data;for(a in b){f=b[a],this.dataColorRange[a]=[],d=-1;for(h in c)if(d++,e=f[0],g=null!=f[1]?f[1]:1/0,h>=e&&g>=h)this.dataColorRange[a].push(d);else if(h>g)break}}return this._drawColorRange()},b.prototype._drawColorRange=function(){var a,b,c,d,e,f,g;f=this.dataColorRange,g=[];for(a in f)d=f[a],b=Math.min.apply(null,d),e=Math.max.apply(null,d),c=d.length,this.canvas.fillStyle=a,g.push(this.canvas.fillRect(b*this.canvasScale,0,c*this.canvasScale,this.canvasHeight));return g},b.prototype._renderRangeCells=function(){var a,b,c,d,e;a=0,this.canvas.fillStyle=this.settings.colorCell,d=this.options.data,e=[];for(b in d)c=d[b],e.push(this._renderRangeCell(a++,c));return e},b.prototype._renderRangeCell=function(a,b){var c;return c=this.canvasHeight/this._maxRangeVolume*b,this.canvas.fillRect(this.canvasScale*a,this.canvasHeight,this.canvasScale,-c)},b.prototype._renderGreyRange=function(){var a,b,c,d,e,f;for(this.greyCanvasLeft=this._rangeGreyElementLeft[0].getContext("2d"),this._rangeGreyElementLeft[0].width=this._rangeElement[0].width,this._rangeGreyElementLeft[0].height=this._rangeElement[0].height,this._rangeGreyElementLeft.width(this._widthWithoutPaddings),this.greyCanvasRight=this._rangeGreyElementRight[0].getContext("2d"),this._rangeGreyElementRight[0].width=this._rangeElement[0].width,this._rangeGreyElementRight[0].height=this._rangeElement[0].height,this._rangeGreyElementRight.width(this._widthWithoutPaddings),d=this.canvas.getImageData(0,0,this._rangeElement[0].width,this._rangeElement[0].height),b=d.data,c=e=0,f=b.length-1;f>=e;c=e+=4)a=.34*b[c]+.5*b[c+1]+.16*b[c+2],b[c]=a,b[c+1]=a,b[c+2]=a;return this.greyCanvasLeft.putImageData(d,0,0),this.greyCanvasRight.putImageData(d,0,0)},b.prototype._renderRangeWraps=function(){var a,b;return a=(this._leftControlValue-this._min)*this._pxInValue+this._controlWidth-this._controlWidth/2,b=this._width-((this._rightControlValue-this._min)*this._pxInValue+this._controlWidth+this._controlWidth/2),this._rangeGreyWrapLeft.css({width:a}),this._rangeGreyWrapRight.css({width:b})},b.prototype._renderRangeHover=function(){var a=this;return this.canvasHover=this._rangeElementHover[0].getContext("2d"),this._rangeElementHover[0].width=this._rangeElement[0].width,this._rangeElementHover[0].height=this._rangeElement[0].height,this._rangeElementHover.width(this._widthWithoutPaddings),this._rangeElementHover.on("mousemove",function(b){var c;return c=b.offsetX,a._drawRangeHover(a._getValueByPosition(c))})},b.prototype._drawRangeHover=function(a){return this.canvasHover.clearRect(0,0,this._rangeElement[0].width,this._rangeElement[0].height),console.log(a),this._renderRangeCell(a,this.getVolumeByValue(a))},b.prototype._formatLeftControl=function(){var a;return a=this._getLeftValue(),null!=this._formatControlCallback?this._leftControl.html(this._formatControlCallback(a)):void 0},b.prototype._formatRightControl=function(){var a;return a=this._getRightValue(),null!=this._formatControlCallback?this._rightControl.html(this._formatControlCallback(a)):void 0},b.prototype._getLeftValue=function(){var a;return a=Object.keys(this.options.data)[this._leftControlValue-1],null==a&&(a=0),parseInt(a)},b.prototype._getRightValue=function(){var a;return a=Object.keys(this.options.data)[this._rightControlValue-1],null==a&&(a=0),parseInt(a)},b.prototype.getVolumeByValue=function(a){return this.options.data[a]},b.prototype.testCanvasSupport=function(){return!!document.createElement("canvas").getContext},b}(a),$.fn.rangeControl=function(b){var c;return c=a.prototype.PLUGINNAME,this.each(function(){return void 0===$(this).data(c)?new a($(this),b):$(this).data(c)})},$.fn.rangeControlGraph=function(a){var c;return c=b.prototype.PLUGINNAME,this.each(function(){return void 0===$(this).data(c)?new b($(this),a):$(this).data(c)})}}.call(this);