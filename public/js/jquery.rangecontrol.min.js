(function(){var t;t=function(){function t(t,e){this.el=t,this.settings=$.extend({},this.defaultOptions,e),this.el.data("range-control",this),this._formatControlCallback=this.settings.formatControlCallback,this._leftControl=this.el.find(".range-control_mini__left"),this._rightControl=this.el.find(".range-control_mini__right"),this._rangeElement=this.el.find(".range-control_mini__range.is-active"),this.min(this.el.data("min")||this.settings.min),this.max(this.el.data("max")||this.settings.max),this.valueStep(this.el.data("value-step")||this.settings.valueStep),this._controlWidth=this._leftControl.outerWidth(),this._width=this.el.outerWidth(),this._widthWithoutPaddings=this.el.width(),this._pxInValue=this._widthWithoutPaddings/(this._max-this._min),this.leftValue(this.el.data("left-value")||this.settings.leftValue||this._min),this.rightValue(this.el.data("right-value")||this.settings.rightValue||this._max),this._initControls()}return t._min,t._max,t._leftControlValue,t._rightControlValue,t._valueStep,t._dragged,t._renderControlCallback,t._width,t._widthWithoutPaddings,t._controlWidth,t._pxInValue,t._rangeElement,t._changeTimeout,t.prototype.DRAGCLASSNAME="is-dragged",t.prototype.keyCode={LEFT:37,RIGHT:39},t.prototype.defaultOptions={keyLeft:t.prototype.keyCode.LEFT,keyRight:t.prototype.keyCode.RIGHT,min:0,max:100,valueStep:1,timeout:500,formatControlCallback:function(t){return t}},t.prototype.min=function(t){return null!=t?this._min=parseInt(t):this._min},t.prototype.max=function(t){return null!=t?this._max=parseInt(t):this._max},t.prototype.valueStep=function(t){return null!=t?this._valueStep=parseInt(t):this._valueStep},t.prototype.value=function(){return{leftValue:this.leftValue(),rightValue:this.rightValue()}},t.prototype.leftValue=function(t){return null!=t?(this._leftControlValue=this._validateLeftValue(t),this._leftValueWithoutRender(this._leftControlValue),this._renderLeftControl(this._leftControlValue)):this._leftValueWithoutRender()},t.prototype._leftValueWithoutRender=function(t){return null!=t?(this._renderRange(),this._formatLeftControl()):1===this._valueStep?this._leftControlValue:this._min+(this._leftControlValue-this._min-(this._leftControlValue-this._min)%this._valueStep)},t.prototype.rightValue=function(t){return null!=t?(this._rightControlValue=this._validateRightValue(t),this._rightValueWithoutRender(this._rightControlValue),this._renderRightControl(this._rightControlValue)):this._rightValueWithoutRender()},t.prototype._rightValueWithoutRender=function(t){return null!=t?(this._renderRange(),this._formatRightControl()):1===this._valueStep?this._rightControlValue:this._min+(this._rightControlValue-this._min-(this._rightControlValue-this._min)%this._valueStep)},t.prototype._getValueByPosition=function(t){return this._min+Math.round(t/this._pxInValue)},t.prototype._valueByControl=function(t,e){if(null!=t){if(t[0]===this._leftControl[0])return null!=e?this.leftValue(e):this.leftValue();if(t[0]===this._rightControl[0])return null!=e?this.rightValue(e):this.rightValue()}},t.prototype._getPositionByValue=function(){},t.prototype._bindControlKeys=function(){var t,e,o,i,n,r=this;for(e=[this._leftControl,this._rightControl],n=[],o=0,i=e.length;i>o;o++)t=e[o],n.push(t.on("keydown",function(e){return t=$(e.currentTarget),e.keyCode===r.settings.keyLeft?r._valueByControl(t,r._valueByControl(t)-1):e.keyCode===r.settings.keyRight?r._valueByControl(t,r._valueByControl(t)+1):void 0}));return n},t.prototype._initControls=function(){var t,e=this;return t=[this._leftControl,this._rightControl],t.forEach(function(t){return t.on("dragstart",function(){return!1}),t.on("mouseup",function(){return e.dragged=!1,t.removeClass(e.DRAGCLASSNAME),$(document).off("mousemove")})}),this._leftControl.on("mousedown",function(t){var o,i,n,r;if(1===t.which)return e._leftControl.addClass(e.DRAGCLASSNAME),e._dragged=!0,r=e.el.offset().left,n=t.clientX-e._leftControl.offset().left,o=0,i=e._rightControl.offset().left-r,$(document).on("mousemove",function(t){return e._controlMoveTo(e._leftControl,t.clientX,r,n,o,i)})}),this._rightControl.on("mousedown",function(t){var o,i,n,r,l;if(1===t.which)return e._rightControl.addClass(e.DRAGCLASSNAME),e._dragged=!0,l=e.el.offset().left,o=e._controlWidth,r=t.clientX-e._rightControl.offset().left,i=e._leftControl.offset().left-l+e._controlWidth,n=e._width,$(document).on("mousemove",function(t){return e._controlMoveTo(e._rightControl,t.clientX,l,r,i,n)})}),$(document).on("mouseup",function(){return e._leftControl.triggerHandler("mouseup"),e._rightControl.triggerHandler("mouseup")}),this._renderLeftControl(this.leftValue()),this._renderRightControl(this.rightValue()),this._bindControlKeys()},t.prototype._controlMoveTo=function(t,e,o,i,n,r){var l,h,s;return h=e-o-i,s=e-o-i+this._controlWidth,h>=n&&r>s&&t.css("left",h),n>h&&t.css("left",n),s>r&&t.css("left",r-this._controlWidth),l=t.position().left,t===this._leftControl&&this.leftValue(this._getValueByPosition(l)),t===this._rightControl&&this.rightValue(this._getValueByPosition(l-this._controlWidth)),this._fireChangeEvent()},t.prototype._renderRange=function(){var t,e;return t=(this._leftControlValue-this._min)*this._pxInValue+this._controlWidth-this._controlWidth/2,e=(this._rightControlValue-this._min)*this._pxInValue+this._controlWidth+this._controlWidth/2,this._rangeElement.css({left:t,right:this._width-e})},t.prototype._renderLeftControl=function(t){var e;return e=(t-this._min)*this._pxInValue,this._leftControl.css({left:e})},t.prototype._renderRightControl=function(t){var e;return e=this._controlWidth+(t-this._min)*this._pxInValue,this._rightControl.css({left:e})},t.prototype._validateLeftValue=function(t){return this._min>=t?this._min:t>=this.rightValue()?this.rightValue():t},t.prototype._validateRightValue=function(t){return t>=this._max?this._max:this.leftValue()>=t?this.leftValue():t},t.prototype.renderControl=function(t){return null!=t&&"function"==typeof t?this._renderControlCallback=t:void 0},t.prototype._formatLeftControl=function(){return null!=this._formatControlCallback?this._leftControl.html(this._formatControlCallback(this.leftValue())):void 0},t.prototype._formatRightControl=function(){return null!=this._formatControlCallback?this._rightControl.html(this._formatControlCallback(this.rightValue())):void 0},t.prototype._formatValue=function(t){return t},t.prototype._fireChangeEvent=function(){var t=this;return clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){return t.el.trigger("change",t.value)},this.settings.timeout)},t}(),$.fn.rangeControl=function(e){return this.each(function(){return void 0===$(this).data("range-control")?new t($(this),e):$(this).data("range-control")})}}).call(this);