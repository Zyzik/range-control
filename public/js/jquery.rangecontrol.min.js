(function(){var t,e,n={}.hasOwnProperty,i=function(t,e){function i(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};t=function(){function t(t,e){this.el=t,this.options=e,this.settings=$.extend({},this.defaultOptions,e),this.el.data(this.PLUGINNAME,this),this._formatControlCallback=this.settings.formatControlCallback,this._renderRangeControl(),this.min(this.el.data("min")||this.settings.min),this.max(this.el.data("max")||this.settings.max),this.step(this.el.data("step")||this.settings.step),this._initDimensions(),this.leftValue(this.el.data("left-value")||this.settings.leftValue||this._min),this.rightValue(this.el.data("right-value")||this.settings.rightValue||this._max),this._initControls(),this._bindResize()}return t._min,t._max,t._leftControlValue,t._rightControlValue,t._step,t._dragged,t._renderControlCallback,t._width,t._widthWithoutPaddings,t._controlWidth,t._pxInValue,t._rangeElement,t._changeTimeout,t.prototype.PLUGINNAME="range-control",t.prototype.DRAGCLASSNAME="is-dragged",t.prototype.keyCode={LEFT:37,RIGHT:39},t.prototype.defaultOptions={keyLeft:t.prototype.keyCode.LEFT,keyRight:t.prototype.keyCode.RIGHT,min:0,max:100,step:1,timeout:500,formatControlCallback:function(t){return t}},t.prototype.min=function(t){return null!=t?this._min=parseInt(t):this._min},t.prototype.max=function(t){return null!=t?this._max=parseInt(t):this._max},t.prototype.step=function(t){return t?this._step=parseInt(t):this._step},t.prototype.value=function(){return{leftValue:this._getLeftValue(),rightValue:this._getRightValue()}},t.prototype.leftValue=function(t){return null!=t?(this._leftControlValue=this._validateLeftValue(t),this._renderLeftControl(this._leftControlValue),this._formatLeftControl(),this._renderRange()):this._getLeftValue()},t.prototype.rightValue=function(t){return null!=t?(this._rightControlValue=this._validateRightValue(t),this._renderRightControl(this._rightControlValue),this._formatRightControl(),this._renderRange()):this._getRightValue()},t.prototype._getLeftValue=function(){return 1===this._valueStep?this._leftControlValue:this._min+(this._leftControlValue-this._min-(this._leftControlValue-this._min)%this._step)},t.prototype._getRightValue=function(){return 1===this._valueStep?this._rightControlValue:this._min+(this._rightControlValue-this._min-(this._rightControlValue-this._min)%this._step)},t.prototype._getValueByPosition=function(t){return this._min+Math.round(t/this._pxInValue)},t.prototype._valueByControl=function(t,e){if(null!=t){if(t[0]===this._leftControl[0])return null!=e?this.leftValue(e):this.leftValue();if(t[0]===this._rightControl[0])return null!=e?this.rightValue(e):this.rightValue()}},t.prototype._getPositionByValue=function(){},t.prototype._bindControlKeys=function(){var t,e,n,i,r,o=this;for(e=[this._leftControl,this._rightControl],r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(t.on("keydown",function(e){return t=$(e.currentTarget),e.keyCode===o.settings.keyLeft?o._valueByControl(t,o._valueByControl(t)-1):e.keyCode===o.settings.keyRight?o._valueByControl(t,o._valueByControl(t)+1):void 0}));return r},t.prototype._bindResize=function(){var t=this;return $(window).on("resize",function(){return t.render()})},t.prototype._initDimensions=function(){return this._controlWidth=this._leftControl.outerWidth(),this._width=this.el.outerWidth(),this._widthWithoutPaddings=this.el.width(),this._pxInValue=this._widthWithoutPaddings/(this._max-this._min)},t.prototype._initControls=function(){var t,e,n,i,r=this;for(e=[this._leftControl,this._rightControl],n=0,i=e.length;i>n;n++)t=e[n],t.on("dragstart",function(){return!1}),t.on("mouseup",function(){return r.dragged=!1,t.removeClass(r.DRAGCLASSNAME),$(document).off("mousemove")});return this._leftControl.on("mousedown",function(t){var e,n,i,o;if(1===t.which)return r._leftControl.addClass(r.DRAGCLASSNAME),r._dragged=!0,o=r.el.offset().left,i=t.clientX-r._leftControl.offset().left,e=0,n=r._rightControl.offset().left-o,$(document).on("mousemove",function(t){return r._controlMoveTo(r._leftControl,t.clientX,o,i,e,n)})}),this._rightControl.on("mousedown",function(t){var e,n,i,o;if(1===t.which)return r._rightControl.addClass(r.DRAGCLASSNAME),r._dragged=!0,o=r.el.offset().left,i=t.clientX-r._rightControl.offset().left,e=r._leftControl.offset().left-o+r._controlWidth,n=r._width,$(document).on("mousemove",function(t){return r._controlMoveTo(r._rightControl,t.clientX,o,i,e,n)})}),$(document).on("mouseup",function(){return r._leftControl.triggerHandler("mouseup"),r._rightControl.triggerHandler("mouseup")}),this._renderLeftControl(this._leftControlValue),this._renderRightControl(this._rightControlValue),this._bindControlKeys()},t.prototype._controlMoveTo=function(t,e,n,i,r,o){var s,h,a;return h=e-n-i,a=e-n-i+this._controlWidth,h>=r&&o>a&&(s=h),r>h&&(s=r),a>o&&(s=o-this._controlWidth),t===this._leftControl&&this.leftValue(this._getValueByPosition(s)),t===this._rightControl&&this.rightValue(this._getValueByPosition(s-this._controlWidth)),this._fireChangeEvent()},t.prototype._renderRangeControl=function(){var t;return this.el.addClass(this.PLUGINNAME),this.el.children().remove(),this._leftControl=$("<button class='"+this.PLUGINNAME+"__left'></button>"),this._rightControl=$("<button class='"+this.PLUGINNAME+"__right'></button>"),this._rangeElement=$("<div class='"+this.PLUGINNAME+"__range is-active'></div>"),t=$("<div class='"+this.PLUGINNAME+"__range'></div>"),this.el.append(this._leftControl).append(this._rightControl).append(t).append(this._rangeElement)},t.prototype._renderRange=function(){var t,e;return t=(this._leftControlValue-this._min)*this._pxInValue+this._controlWidth-this._controlWidth/2,e=(this._rightControlValue-this._min)*this._pxInValue+this._controlWidth+this._controlWidth/2,this._rangeElement.css({left:t,right:this._width-e})},t.prototype._renderLeftControl=function(t){var e;return e=(t-this._min)*this._pxInValue,this._leftControl.css({left:e})},t.prototype._renderRightControl=function(t){var e;return e=this._controlWidth+(t-this._min)*this._pxInValue,this._rightControl.css({left:e})},t.prototype._validateLeftValue=function(t){return this._min>=t?this._min:t>=this._rightControlValue?this._rightControlValue:t},t.prototype._validateRightValue=function(t){return t>=this._max?this._max:this._leftControlValue>=t?this._leftControlValue:t},t.prototype._formatLeftControl=function(){return null!=this._formatControlCallback?this._leftControl.html(this._formatControlCallback(this.leftValue())):void 0},t.prototype._formatRightControl=function(){return null!=this._formatControlCallback?this._rightControl.html(this._formatControlCallback(this.rightValue())):void 0},t.prototype._formatValue=function(t){return t},t.prototype._fireChangeEvent=function(){var t=this;return clearTimeout(this._changeTimeout),this._changeTimeout=setTimeout(function(){return t.el.trigger("change",t.value())},this.settings.timeout)},t.prototype.render=function(){return this._initDimensions(),this.leftValue(this.leftValue()),this.rightValue(this.rightValue())},t.prototype.rebuild=function(t){return null==t&&(t=this.options),this.constructor(this.el,t)},t.prototype.destroy=function(){return this.el.html(""),this.el.removeData(this.PLUGINNAME)},t}(),e=function(t){function e(t,n){this.el=t,this.options=n,this.settings=$.extend({},this.defaultOptions,n),this._renderRangeControl(),this._initDimensions(),this._renderRange(),this.min(0),this.max(Object.keys(this.options.data).length),this.leftValue(this.min()),this.rightValue(this.max()),e.__super__.constructor.call(this,this.el,$.extend(this.settings,{min:this.min(),max:this.max()}))}return i(e,t),e.prototype.PLUGINNAME="range-control-graph",e.prototype.defaultOptions={keyLeft:e.prototype.keyCode.LEFT,keyRight:e.prototype.keyCode.RIGHT,min:0,max:100,step:1,timeout:500,formatControlCallback:function(t){return t},colorsRange:{"#e6ead4":[0,100],"#ced7a6":[101,1e3],"#b4c373":[1001,1e4],"#fed46d":[10001]},colorCell:"#288bf0"},e.prototype._renderRangeControl=function(){return this.el.addClass(this.PLUGINNAME),this.el.children().remove(),this._leftControl=$("<button class='"+this.PLUGINNAME+"__left'></button>").appendTo(this.el),this._rightControl=$("<button class='"+this.PLUGINNAME+"__right'></button>").appendTo(this.el),this._rangeElement=$("<canvas class='"+this.PLUGINNAME+"__range'></canvas>").appendTo(this.el),this._rangeElementHover=$("<canvas class='"+this.PLUGINNAME+"__range-hover'></canvas>").appendTo(this.el),this._rangeGreyWrapLeft=$("<div class='"+this.PLUGINNAME+"__wrap-range-grey-left'></div>"),this._rangeGreyElementLeft=$("<canvas class='"+this.PLUGINNAME+"__range-grey'></canvas>").appendTo(this._rangeGreyWrapLeft),this._rangeGreyWrapRight=$("<div class='"+this.PLUGINNAME+"__wrap-range-grey-right'></div>"),this._rangeGreyElementRight=$("<canvas class='"+this.PLUGINNAME+"__range-grey'></canvas>").appendTo(this._rangeGreyWrapRight),this._rangeGreyWrapLeft.appendTo(this.el),this._rangeGreyWrapRight.appendTo(this.el)},e.prototype._renderRange=function(){var t,e,n,i;return e=function(){var t,e;t=this.options.data,e=[];for(n in t)i=t[n],e.push(i);return e}.call(this),this._maxRangeVolume=Math.max.apply(null,e),t=Object.keys(this.options.data).length,this.canvas=this._rangeElement[0].getContext("2d"),this.canvasScale=30,this.canvasHeight=this.el.height(),this.canvasWidth=t*this.canvasScale,this._rangeElement[0].width=t*this.canvasScale,this._rangeElement[0].height=this.el.height(),this._rangeElement.width(this._widthWithoutPaddings),this._renderColorRange(),this._renderRangeCells(),this._renderGreyRange(),this._renderRangeWraps(),this._renderRangeHover()},e.prototype._renderColorRange=function(){var t,e,n,i,r,o,s,h;if(null==this.dataColorRange){this.dataColorRange={},e=this.settings.colorsRange,n=this.settings.data;for(t in e){o=e[t],this.dataColorRange[t]=[],i=-1;for(h in n)if(i++,r=o[0],s=null!=o[1]?o[1]:1/0,h>=r&&s>=h)this.dataColorRange[t].push(i);else if(h>s)break}}return this._drawColorRange()},e.prototype._drawColorRange=function(){var t,e,n,i,r,o,s;o=this.dataColorRange,s=[];for(t in o)i=o[t],e=Math.min.apply(null,i),r=Math.max.apply(null,i),n=i.length,this.canvas.fillStyle=t,s.push(this.canvas.fillRect(e*this.canvasScale,0,n*this.canvasScale,this.canvasHeight));return s},e.prototype._renderRangeCells=function(){var t,e,n,i,r;t=0,this.canvas.fillStyle=this.settings.colorCell,i=this.options.data,r=[];for(e in i)n=i[e],r.push(this._renderRangeCell(t++,n));return r},e.prototype._renderRangeCell=function(t,e){var n;return n=this.canvasHeight/this._maxRangeVolume*e,this.canvas.fillRect(this.canvasScale*t,this.canvasHeight,this.canvasScale,-n)},e.prototype._renderGreyRange=function(){var t,e,n,i,r,o;for(this.greyCanvasLeft=this._rangeGreyElementLeft[0].getContext("2d"),this._rangeGreyElementLeft[0].width=this._rangeElement[0].width,this._rangeGreyElementLeft[0].height=this._rangeElement[0].height,this._rangeGreyElementLeft.width(this._widthWithoutPaddings),this.greyCanvasRight=this._rangeGreyElementRight[0].getContext("2d"),this._rangeGreyElementRight[0].width=this._rangeElement[0].width,this._rangeGreyElementRight[0].height=this._rangeElement[0].height,this._rangeGreyElementRight.width(this._widthWithoutPaddings),i=this.canvas.getImageData(0,0,this._rangeElement[0].width,this._rangeElement[0].height),e=i.data,n=r=0,o=e.length-1;o>=r;n=r+=4)t=.34*e[n]+.5*e[n+1]+.16*e[n+2],e[n]=t,e[n+1]=t,e[n+2]=t;return this.greyCanvasLeft.putImageData(i,0,0),this.greyCanvasRight.putImageData(i,0,0)},e.prototype._renderRangeWraps=function(){var t,e;return t=(this._leftControlValue-this._min)*this._pxInValue+this._controlWidth-this._controlWidth/2,e=this._width-((this._rightControlValue-this._min)*this._pxInValue+this._controlWidth+this._controlWidth/2),this._rangeGreyWrapLeft.css({width:t}),this._rangeGreyWrapRight.css({width:e})},e.prototype._renderRangeHover=function(){var t=this;return this.canvasHover=this._rangeElementHover[0].getContext("2d"),this._rangeElementHover[0].width=this._rangeElement[0].width,this._rangeElementHover[0].height=this._rangeElement[0].height,this._rangeElementHover.width(this._widthWithoutPaddings),this._rangeElementHover.on("mousemove",function(e){var n,i;return n=e.offsetX,i=e.offsetY,t._drawRangeHover(t._getValueByPosition(n))})},e.prototype._drawRangeHover=function(){return this.canvasHover.clearRect(0,0,this._rangeElement[0].width,this._rangeElement[0].height)},e.prototype._formatLeftControl=function(){var t;return t=this._getLeftValue(),null!=this._formatControlCallback?this._leftControl.html(this._formatControlCallback(t)):void 0},e.prototype._formatRightControl=function(){var t;return t=this._getRightValue(),null!=this._formatControlCallback?this._rightControl.html(this._formatControlCallback(t)):void 0},e.prototype._getLeftValue=function(){var t;return t=Object.keys(this.options.data)[this._leftControlValue-1],null==t&&(t=0),parseInt(t)},e.prototype._getRightValue=function(){var t;return t=Object.keys(this.options.data)[this._rightControlValue-1],null==t&&(t=0),parseInt(t)},e.prototype.getVolumeByValue=function(t){return this.options.data[t]},e.prototype.testCanvasSupport=function(){return!!document.createElement("canvas").getContext},e}(t),$.fn.rangeControl=function(e){var n;return n=t.prototype.PLUGINNAME,this.each(function(){return void 0===$(this).data(n)?new t($(this),e):$(this).data(n)})},$.fn.rangeControlGraph=function(t){var n;return n=e.prototype.PLUGINNAME,this.each(function(){return void 0===$(this).data(n)?new e($(this),t):$(this).data(n)})}}).call(this);